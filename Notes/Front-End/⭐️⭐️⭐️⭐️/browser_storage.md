# 브라우저 저장소

### 브라우저 저장소에 대해서 차이점을 설명해주세요.(LocalStorage, SessionStorge, Cookie)

<br>

---

<br>

## Anwer

쿠키와 웹 스토리지를 설명하기 전에 HTTP 프로토콜의 특징을 먼저 살펴보자.

# 배경: HTTP의 특징

HTTP는 **Connectionless**하고 **Stateless**하다고 한다.

Connectionless
클라이언트가 서버로 request를 보내고 서버가 클라이언트에게 response를 한 후 접속을 종료하는 특성이 있다.

Stateless
접속을 종료함과 동시에 클라이언트와 서버의 통신이 끝나고 상태정보를 유지하지 않는다는 특성이 있다.

> 서버가 꺼졌다고 해서 바로 연결이 되서 클라이언트에 반영이 되지 않는다. 서버가 죽었을 때 클라이언트도 화면이 안보여야 하는데 그렇지 않다는거. 클라이언트가 새로운 request 보내기 전 까지는 클라이언트에 기존 화면이 남아있다.

위 두 특성의 장점과 단점
장점: 접속을 유지함에 따르는 리소스를 줄일 수 있다.
단점: 클라이언트와 서버가 통신을 할 때 마다 클라이언트 인증을 해야 한다.

즉 클라이언트의 로그인 정보나 브러우저에서 입력한 값등이 페이지 이동 시 마다 초기화 된다는 것.

예를 들어 쇼핑몰에서 옷을 구매하려고 할 때  로그인을 했음에도 페이지를 이동할 때 마다 계속 로그인을 해야한다. 장바구니라는 것이 없어서 내가 구매할 제품들을 내가 따로 기록해 각각 하나씩 구매해야 할 것이다. 또한 매 제품 구매 단계마다 로그인을 해야 한다.

이러한 단점을 보완하기 위해 쿠키와 세션이 등장했다.

# 쿠키란?

- 클라이언트 로컬에 저장되는 키와 값 형태의 작은 파일이다.
- 브라우저는 쿠키를 저장해놓았다가 동일한 서버로 재 요청 시 저장된 데이터(쿠키)를 요청과 함께 서버로 보낸다.

## 쿠키의 주요 목적 3가지

1. 세션 관리 (Session Management): 서버에 저장해야 할 로그인정보, 장바구니, 게임스코어 등의 정보 관리
2. 개인화 (Personalization): 사용자 선호 옵션이나 테마 등의 세팅
3. 트래킹 (Tracking): 사용자의 행동을 기록하고 분석하는 용도

## 쿠키의 동작방식

1. 클라이언트가 서버로 첫 요청을 보낸다.
2. 서버에서 쿠키를 생성한다.
3. HTTP 헤더에 쿠키를 포함하여 클라이언트에게 응답을 보낸다.
4. 클라이언트에서는 이 쿠키를 보관한다. 브라우저가 종료되어도 정해진 쿠키 만료기간 내에는 보관이 유지된다.
5. 클라이언트가 동일한 서버로 재요청 시 HTTP헤더에 쿠키를 함께 보낸다.
6. 서버에서 쿠키를 읽는다. 상태 정보를 변경할 필요가 있을 경우에는 쿠키를 업데이트하여 HTTP헤더에 포함해 응답한다.

- 브라우저에서 서버로 나에 대한 정보를 가져오라는 GET /me라는 요청을 보낼 때, 서버는 요청 자체만으로는 그 요청이 누구에게서 오는 지 알 수 없다.
- 그래서 이 때 쿠키에 나에 대한 정보를 담아서 서버로 보낸다.
- 서버는 쿠키를 읽어서 내가 누군지 파악한다.
- 쿠키는 처음부터 서버와 클라이언트 간의 지속적인 데이터 교환을 위해 만들어졌고, 때문에 서버로 계속 전송된다.

## Permanent Cookie & Session Cookie

- Permanent Cookie: 클라언트(브라우저)가 종료되어도 일정기간(Expires, Max-Age 명시) 유지되는 쿠키
- Session Cookie: 클라이언트(브라우저) 종료 시 삭제되는 휘발성 쿠키(Expires, Max-Age 에 아무것도 명시하지 않음)

### ※ Session이란?

- 일정 시간동안 같은 사용자(브라우저)로부터 들어오는 요구를 하나의 '상태'로 보고 그 상태를 유지하는 기술
- 이 때 '일정 시간'이란 사용자가 브라우저를 통해 서버에 접속한 시점으로부터 브라우저 종료 시점(연결 종료) 까지를 말한다.

## 쿠키의 문제점

- 만약 4kb 용량 제한을 거의 다 채운 쿠키가 있다면, 클라이언트가 서버로 요청을 할 때마다 기본 4kb의 데이터를 사용한다.
- 그런데 이 4kb 중에는 서버에서 필요하지 않은 데이터들도 있을 것이다. -> 데이터 낭비가 발생
- 바로 그런 데이터들을 이제 웹 스토리지(로컬 스토리지와 세션 스토리지)에 저장하도록 한다.
- 이 두 저장소의 데이터는 서버로 자동 전송되지 않는다.
  </br>

# 웹 스토리지

- HTML5에서 간단한 키와 값을 저장할 수 있는 저장소이다.
- 쿠키와 달리 저장된 정보는 서버로 전송되지 않는다.
- 브라우저가 직접 데이터를 저장한다.
- 쿠키의 저장공간은 4KB인 것에 반해 웹 스토리지는 약 5MB까지 저장이 가능하다.

## 웹 스토리지의 종류: 로컬 스토리지와 세션 스토리지

### 로컬 스토리지 (Local Storage)

- 브라우저 자체에 반영구적으로 데이터를 저장한다.
- 브라우저 종료 시 OR 컴퓨터 재부팅 시 에도 데이터를 유지한다.
- 도메인이 다른 경우 로컬스토리지에 접근할 수 없다.
  - 예를 들어 www.google.com의 로컬 스토리지에서 저장된 데이터는 www.naver.com에서는 접근할 수 없다.

_읽어보기_

> 메소드를 간단히 설명하자면, localStorage.setItem(키, 값)으로 로컬스토리지에 저장한 후, localStorage.getItem(키)로 조회하면 됩니다. localStorage.removeItem(키)하면 해당 키가 지워지고, localStorage.clear()하면 스토리지 전체가 비워집니다.

> 이렇게 데이터가 지우기 전까지는 계속 저장되어 있기 때문에 유저 커스터마이제이션에 좋을 것 같습니다. 사용자의 설정(보안에 민감하지 않은)이나 데이터들을 넣어두면 됩니다.

</br>

### 세션 스토리지 (Session Storage)

- 각 세션마다 데이터를 개별적으로 저장한다.
- 로컬 스토리지와 달리 세션 종료 시에 데이터가 자동으로 제거된다.
- 같은 도메인이라도 세션이 다르면 데이터에 접근할 수 없다.
  - 예를 들어 브라우저에서 여러 탭을 실행하면 각 탭마다 데이터가 저장된다.
  - 이 때 브라우저 탭 OR 창을 닫으면 저장된 데이터는 사라진다.

---

References
https://www.zerocho.com/category/HTML&DOM/post/5918515b1ed39f00182d3048

https://interconnection.tistory.com/74
https://ykss.netlify.app/web/storage_session_cookie/
https://velog.io/@hellozin/%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%9B%B9-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80
